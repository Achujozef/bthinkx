{% extends 'base.html' %}
{% load static %}

{% block title %}My Projects - BThinkX{% endblock %}

{% block extra_css %}
<style>
    .projects-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
        flex-wrap: wrap;
        gap: 16px;
    }

    .projects-title {
        font-size: 32px;
        font-weight: 800;
        font-family: 'Space Grotesk', sans-serif;
        background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .projects-controls {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        align-items: center;
    }

    .filter-group {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
    }

    .filter-select {
        padding: 10px 16px;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 8px;
        color: var(--text-primary);
        font-family: 'Inter', sans-serif;
        cursor: pointer;
        transition: var(--transition);
        font-size: 14px;
        font-weight: 500;
    }

    .filter-select:hover {
        border-color: var(--accent-blue);
        background: rgba(59, 130, 246, 0.1);
    }

    .filter-select:focus {
        outline: none;
        border-color: var(--accent-blue);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }

    /* Projects Grid */
    .projects-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 24px;
        margin-bottom: 40px;
    }

    /* Project Card */
    .project-card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        transition: var(--transition);
        height: 100%;
    }

    .project-card:hover {
        border-color: var(--accent-blue);
        background: rgba(59, 130, 246, 0.05);
        transform: translateY(-4px);
        box-shadow: 0 15px 40px rgba(59, 130, 246, 0.2);
    }

    .project-card-header {
        padding: 24px;
        border-bottom: 1px solid var(--card-border);
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
    }

    .project-card-title-section {
        flex: 1;
        min-width: 0;
    }

    .project-code {
        font-size: 12px;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .project-card-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 4px;
        word-break: break-word;
        line-height: 1.3;
    }

    .project-card-client {
        font-size: 13px;
        color: var(--accent-blue);
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .project-status-badge {
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 600;
        text-transform: capitalize;
        display: inline-block;
        white-space: nowrap;
    }

    .project-status-badge.planning {
        background: rgba(226, 232, 240, 0.1);
        color: var(--text-secondary);
        border: 1px solid rgba(226, 232, 240, 0.2);
    }

    .project-status-badge.ongoing {
        background: rgba(59, 130, 246, 0.1);
        color: var(--accent-blue);
        border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .project-status-badge.on_hold {
        background: rgba(245, 158, 11, 0.1);
        color: var(--accent-yellow);
        border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .project-status-badge.completed {
        background: rgba(16, 185, 129, 0.1);
        color: var(--accent-green);
        border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .project-status-badge.cancelled {
        background: rgba(239, 68, 68, 0.1);
        color: var(--accent-red);
        border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .project-card-body {
        padding: 24px;
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .project-description {
        font-size: 13px;
        color: var(--text-secondary);
        line-height: 1.5;
        word-break: break-word;
        min-height: 40px;
    }

    .project-meta {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 12px 0;
        border-top: 1px solid var(--card-border);
        border-bottom: 1px solid var(--card-border);
    }

    .project-meta-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 13px;
    }

    .project-meta-label {
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .project-meta-value {
        color: var(--text-primary);
        font-weight: 600;
    }

    .project-meta-date {
        color: var(--accent-blue);
    }

    /* Progress Bar */
    .progress-container {
        margin-top: 12px;
    }

    .progress-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 12px;
    }

    .progress-label {
        color: var(--text-secondary);
        font-weight: 500;
    }

    .progress-value {
        color: var(--text-primary);
        font-weight: 700;
    }

    .progress-bar {
        height: 8px;
        background: rgba(139, 92, 246, 0.1);
        border-radius: 4px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
        border-radius: 4px;
        transition: width 0.3s ease;
    }

    /* Team Members */
    .team-members {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 12px;
    }

    .team-members-label {
        font-size: 12px;
        color: var(--text-secondary);
        margin-right: 8px;
    }

    .member-avatar {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 12px;
        font-weight: 600;
        border: 2px solid var(--card-bg);
        transition: var(--transition);
    }

    .member-avatar:hover {
        transform: scale(1.15);
        border-color: var(--accent-blue);
    }

    .member-count {
        font-size: 12px;
        color: var(--text-secondary);
        margin-left: 4px;
    }

    /* Project Card Footer */
    .project-card-footer {
        padding: 16px 24px;
        border-top: 1px solid var(--card-border);
        display: flex;
        gap: 8px;
    }

    .project-action-btn {
        flex: 1;
        padding: 10px 12px;
        background: rgba(139, 92, 246, 0.1);
        color: var(--accent-purple);
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 600;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        text-decoration: none;
    }

    .project-action-btn:hover {
        background: rgba(139, 92, 246, 0.2);
        border-color: var(--accent-purple);
        transform: translateY(-1px);
    }

    .project-action-btn.primary {
        background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
        color: white;
        border: none;
    }

    .project-action-btn.primary:hover {
        box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 80px 20px;
        grid-column: 1 / -1;
    }

    .empty-state-icon {
        font-size: 80px;
        margin-bottom: 16px;
        opacity: 0.5;
    }

    .empty-state-title {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 8px;
        color: var(--text-primary);
    }

    .empty-state-description {
        color: var(--text-secondary);
        font-size: 14px;
        margin-bottom: 24px;
    }

    .empty-state-action {
        padding: 12px 24px;
        background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        font-size: 14px;
    }

    .empty-state-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
    }

    /* Stats Bar */
    .stats-bar {
        display: flex;
        gap: 20px;
        margin-bottom: 32px;
        flex-wrap: wrap;
    }

    .stat-card-mini {
        flex: 1;
        min-width: 150px;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: var(--transition);
    }

    .stat-card-mini:hover {
        border-color: var(--accent-blue);
        background: rgba(59, 130, 246, 0.05);
    }

    .stat-card-mini-icon {
        font-size: 24px;
        opacity: 0.8;
    }

    .stat-card-mini-content {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .stat-card-mini-label {
        font-size: 12px;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    .stat-card-mini-value {
        font-size: 20px;
        font-weight: 700;
        color: var(--text-primary);
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .projects-container {
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }
    }

    @media (max-width: 768px) {
        .projects-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .projects-title {
            font-size: 24px;
        }

        .projects-controls {
            width: 100%;
        }

        .filter-group {
            width: 100%;
        }

        .filter-select {
            flex: 1;
            min-width: 120px;
        }

        .projects-container {
            grid-template-columns: 1fr;
        }

        .project-card-header {
            flex-direction: column;
        }

        .project-card-footer {
            flex-direction: column;
        }

        .project-action-btn {
            width: 100%;
        }

        .stat-card-mini {
            flex: 1;
            min-width: 120px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="content-wrapper" style="padding: 32px 20px;">
    <!-- Page Header -->
    <div class="projects-header">
        <div>
            <h1 class="projects-title">My Projects</h1>
            <p style="color: var(--text-secondary); margin-top: 8px;">
                Collaborate and manage your assigned projects
            </p>
        </div>
        <div class="projects-controls">
            <div class="filter-group">
                <!-- Status Filter -->
                <select class="filter-select" id="statusFilter" onchange="filterProjects()">
                    <option value="">Status: All</option>
                    <option value="planning">Planning</option>
                    <option value="ongoing">Ongoing</option>
                    <option value="on_hold">On Hold</option>
                    <option value="completed">Completed</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Stats Bar -->
    {% if projects.count > 0 %}
    <div class="stats-bar">
        <div class="stat-card-mini">
            <div class="stat-card-mini-icon">üìä</div>
            <div class="stat-card-mini-content">
                <div class="stat-card-mini-label">Total Projects</div>
                <div class="stat-card-mini-value">{{ projects.count }}</div>
            </div>
        </div>
        <div class="stat-card-mini">
            <div class="stat-card-mini-icon">üöÄ</div>
            <div class="stat-card-mini-content">
                <div class="stat-card-mini-label">Ongoing</div>
                <div class="stat-card-mini-value">
                    {% widthratio projects.count 1 1 %}
                </div>
            </div>
        </div>
        <div class="stat-card-mini">
            <div class="stat-card-mini-icon">‚úÖ</div>
            <div class="stat-card-mini-content">
                <div class="stat-card-mini-label">Completed</div>
                <div class="stat-card-mini-value">
                    {% widthratio projects.count 1 1 %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Projects Grid -->
    <div class="projects-container">
        {% if projects %}
            {% for project in projects %}
            <div class="project-card" data-project-id="{{ project.id }}">
                <!-- Card Header -->
                <div class="project-card-header">
                    <div class="project-card-title-section">
                        {% if project.code %}
                        <div class="project-code">{{ project.code }}</div>
                        {% endif %}
                        <h3 class="project-card-title">{{ project.name }}</h3>
                        {% if project.client %}
                        <div class="project-card-client">
                            <i class="bi bi-briefcase"></i>
                            {{ project.client.name }}
                        </div>
                        {% endif %}
                    </div>
                    <span class="project-status-badge {{ project.status }}">
                        {% if project.status == 'planning' %}
                            üìã Planning
                        {% elif project.status == 'ongoing' %}
                            üöÄ Ongoing
                        {% elif project.status == 'on_hold' %}
                            ‚è∏ On Hold
                        {% elif project.status == 'completed' %}
                            ‚úÖ Completed
                        {% elif project.status == 'cancelled' %}
                            ‚ùå Cancelled
                        {% endif %}
                    </span>
                </div>

                <!-- Card Body -->
                <div class="project-card-body">
                    <!-- Description -->
                    {% if project.description %}
                    <div class="project-description">
                        {{ project.description|truncatewords:20 }}
                    </div>
                    {% else %}
                    <div class="project-description" style="color: var(--text-muted);">
                        No description provided
                    </div>
                    {% endif %}

                    <!-- Meta Information -->
                    <div class="project-meta">
                        {% if project.start_date %}
                        <div class="project-meta-item">
                            <span class="project-meta-label">
                                <i class="bi bi-calendar-event"></i> Start Date
                            </span>
                            <span class="project-meta-value project-meta-date">
                                {{ project.start_date|date:"M d, Y" }}
                            </span>
                        </div>
                        {% endif %}

                        {% if project.end_date %}
                        <div class="project-meta-item">
                            <span class="project-meta-label">
                                <i class="bi bi-calendar-check"></i> End Date
                            </span>
                            <span class="project-meta-value project-meta-date">
                                {{ project.end_date|date:"M d, Y" }}
                            </span>
                        </div>
                        {% endif %}

                        {% if project.budget %}
                        <div class="project-meta-item">
                            <span class="project-meta-label">
                                <i class="bi bi-cash-coin"></i> Budget
                            </span>
                            <span class="project-meta-value">
                                ${{ project.budget|floatformat:2 }}
                            </span>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Progress Bar -->
                    <div class="progress-container">
                        <div class="progress-header">
                            <span class="progress-label">Progress</span>
                            <span class="progress-value">{{ project.progress_percent|floatformat:0 }}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ project.progress_percent }}%;"></div>
                        </div>
                    </div>

                    <!-- Team Members -->
                    {% if project.members.all %}
                    <div class="team-members">
                        <span class="team-members-label">Team:</span>
                        {% for member in project.members.all|slice:":3" %}
                        <div class="member-avatar" title="{{ member.user.get_full_name }}">
                            {{ member.user.first_name.0 }}{{ member.user.last_name.0 }}
                        </div>
                        {% endfor %}
                        {% if project.members.all|length > 3 %}
                        <div class="member-count">+{{ project.members.all|length|add:"-3" }} more</div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>

                <!-- Card Footer / Actions -->
                <div class="project-card-footer">
                    <a href="javascript:void(0);" class="project-action-btn" onclick="viewProject('{{ project.id }}')">
                        <i class="bi bi-eye"></i> View
                    </a>
                    <a href="javascript:void(0);" class="project-action-btn primary" onclick="editProject('{{ project.id }}')">
                        <i class="bi bi-pencil"></i> Edit
                    </a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <!-- Empty State -->
            <div class="empty-state">
                <div class="empty-state-icon">üìÅ</div>
                <h3 class="empty-state-title">No Projects Yet</h3>
                <p class="empty-state-description">
                    You haven't been assigned to any projects yet. When projects are assigned to you, they'll appear here.
                </p>
                <button class="empty-state-action" onclick="goToDashboard()">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </button>
            </div>
        {% endif %}
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Filter Projects by Status
    function filterProjects() {
        const status = document.getElementById('statusFilter').value;
        
        const projects = document.querySelectorAll('.project-card');
        let visibleCount = 0;

        projects.forEach(card => {
            const badge = card.querySelector('.project-status-badge');
            const cardStatus = badge.className.match(/status-badge\s+(\w+)/)?.[1] || '';
            
            if (!status || cardStatus === status) {
                card.style.display = '';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        // Show empty state if no projects match
        if (visibleCount === 0) {
            const container = document.querySelector('.projects-container');
            if (!container.querySelector('.filter-empty-state')) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state filter-empty-state';
                emptyState.innerHTML = `
                    <div class="empty-state-icon">üîç</div>
                    <h3 class="empty-state-title">No Projects Found</h3>
                    <p class="empty-state-description">
                        No projects match your selected filter. Try adjusting the filters.
                    </p>
                `;
                container.appendChild(emptyState);
            }
        } else {
            const filterEmpty = document.querySelector('.filter-empty-state');
            if (filterEmpty) {
                filterEmpty.remove();
            }
        }
    }

    // View Project Details
    function viewProject(projectId) {
        // Redirect to project detail page
        // window.location.href = `/projects/${projectId}/`;
        alert(`View project ${projectId}`);
    }

    // Edit Project
    function editProject(projectId) {
        // Redirect to project edit page
        // window.location.href = `/projects/${projectId}/edit/`;
        alert(`Edit project ${projectId}`);
    }

    // Go to Dashboard
    function goToDashboard() {
        window.location.href = '{% url "employee_dashboard" %}';
    }

    // Restore filter selection on page load
    document.addEventListener('DOMContentLoaded', function() {
        const params = new URLSearchParams(window.location.search);
        const status = params.get('status');
        
        if (status) {
            document.getElementById('statusFilter').value = status;
            filterProjects();
        }
    });

    // Add card animation on hover
    document.querySelectorAll('.project-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-4px)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
</script>
{% endblock %}
